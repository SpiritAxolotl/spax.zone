<!DOCTYPE HTML>
<html>
  <head>
    <title>All Custom DEP Character Sprites</title>
    <meta name="description" content="A collection of all of the custom DEP sprites supported on this website.">
    <link rel="stylesheet" href="/css/experimental.css" type="text/css">
    <style>
      #face-selector {
        display: flex;
        justify-content: center;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 5px;
        max-width: 647px;
      }
      #face-selector > img {
        transition: outline-color 0.25s ease-in-out;
        aspect-ratio: 1/1;
        height: 97px;
        cursor: pointer;
        box-sizing: content-box;
        outline-style: solid;
        outline-offset: 0px;
        outline-width: 3px;
        outline-color: transparent;
      }
      #face-name:not([who], [emotion]) {
        text-align: center;
      }
      .selected {
        outline-color: var(--g1) !important;
      }
      /*details[name="spaxshow"] {
        transition: opacity 0.15s linear;
      }
      details[name="spaxshow"]:not([open]) {
        opacity: 0;
      }
      details[name="spaxshow"]:hover {
        opacity: 1;
      }
      details[name="spaxshow"]:not([open]) ~ article[who="spax"] {
        display: none;
      }*/
    </style>
  </head>
  <body>
    <article id="face-selector">
      <img src="/images/faces/nahua/Angry.png">
      <img src="/images/faces/nahua/Bashful.png">
      <img src="/images/faces/nahua/BlushyLook.png">
      <img src="/images/faces/nahua/Confused.png">
      <img src="/images/faces/nahua/Disappointed.png">
      <img src="/images/faces/nahua/Dizzy.png">
      <img src="/images/faces/nahua/Expressionless.png">
      <img src="/images/faces/nahua/Happy.png">
      <img src="/images/faces/nahua/Joyful.png">
      <img src="/images/faces/nahua/Look.png">
      <img src="/images/faces/nahua/LookDown.png">
      <img src="/images/faces/nahua/Nervous.png">
      <img src="/images/faces/nahua/Neutral.png">
      <img src="/images/faces/nahua/Pensive.png">
      <img src="/images/faces/nahua/Sad.png">
      <img src="/images/faces/nahua/Scared.png">
      <img src="/images/faces/nahua/Shocked.png">
      <img src="/images/faces/nahua/Sigh.png">
      <img src="/images/faces/nahua/Sleepy.png">
      <img src="/images/faces/nahua/Smug.png">
      <img src="/images/faces/nahua/SmugEvil.png">
      <img src="/images/faces/nahua/Sus.png">
    </article>
    <article id="face-name">
      Hover over or click on a face!
    </article>
  </body>
  <script>
    const faceName = document.querySelector(`#face-name`);
    const faceSelector = document.querySelector(`#face-selector`);
    // let clicked = false;
    
    const writeClipboardText = async (text, element) => {
      try {
        await navigator.clipboard.writeText(text);
        element.setAttribute("style", "outline-color: var(--a1) !important"); // !important doesn't work when using setter on style["outline-color"]
        // clicked = true;
        setTimeout(_=>{
          // clicked = false;
          element.style["outline-color"] = "";
        }, 1000);
      } catch (error) {
        console.error(error.message);
      }
    };
    
    const getEmotion = (element) => {
      return element.src
        .match(/(\w+)\.png/)[1]
        .split(/(?<=[a-z])(?=[A-Z])/);
    };
    
    const faceUpdate = (event, element) => {
      // if (clicked) return; 
      [...document.querySelectorAll(`.selected`)].forEach(e=>e.classList.remove(`selected`));
      element.classList.add(`selected`);
      const emotions = getEmotion(element);
      faceName.textContent = emotions.join(" ");
      faceName.setAttribute("who", "Nahua");
      faceName.setAttribute("emotion", emotions.join(""));
    };
    
    const faceCopy = (event, element) => {
      writeClipboardText(`<article who="nahua" emotion="${getEmotion(element).join("").toLowerCase()}">\n    \n  </article>`, element);
    };
    
    const doubleTapTimeWindow = 400;
    let lastTap = null;
    let tapTimeout = null;

    const touchyHandler = (event, element) => {
      const now = Date.now();
      if (lastTap && (now - lastTap) < doubleTapTimeWindow) { // Double tap
        clearTimeout(tapTimeout);
        faceCopy(null, element);
        lastTap = null;
      } else {
        faceUpdate(null, element);
        lastTap = now;
        tapTimeout = setTimeout(() => {
          lastTap = null;
        }, doubleTapTimeWindow);
      }
    };

    [...document.querySelectorAll(`#face-selector > img`)].forEach(element => {
      element.addEventListener("mouseover", event => faceUpdate(event, element));
      element.addEventListener("click", event => faceCopy(event, element));
      element.addEventListener("touchstart", event => {
        event.preventDefault();
        touchyHandler(event, element);
      });
    });
  </script>
</html>
