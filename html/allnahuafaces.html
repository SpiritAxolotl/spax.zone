<!DOCTYPE HTML>
<html>
  <head>
    <title>All Nahua DEP Character Portraits</title>
    <meta name="description" content="A collection of all of the custom DEP sprites supported on this website.">
    <link rel="stylesheet" href="/css/experimental.css" type="text/css">
    <style>
      #face-selector {
        display: flex;
        justify-content: center;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 5px;
        max-width: 647px;
      }
      #face-selector > img {
        transition: outline-color 0.15s ease;
        aspect-ratio: 1/1;
        height: 97px;
        cursor: pointer;
        box-sizing: content-box;
        outline-style: solid;
        outline-offset: 0px;
        outline-width: 3px;
        outline-color: transparent;
      }
      #face-name:not([who], [emotion]) {
        text-align: center;
      }
      #face-selector > img.selected {
        outline-color: var(--g1);
      }
      /*details[name="spaxshow"] {
        transition: opacity 0.15s linear;
      }
      details[name="spaxshow"]:not([open]) {
        opacity: 0;
      }
      details[name="spaxshow"]:hover {
        opacity: 1;
      }
      details[name="spaxshow"]:not([open]) ~ article[who="spax"] {
        display: none;
      }*/
    </style>
  </head>
  <body>
    <article id="face-selector">
      <img src="/images/faces/nahua/Angry.png">
      <img src="/images/faces/nahua/Bashful.png">
      <img src="/images/faces/nahua/BlushyLook.png">
      <img src="/images/faces/nahua/Confused.png">
      <img src="/images/faces/nahua/Disappointed.png">
      <img src="/images/faces/nahua/Dizzy.png">
      <img src="/images/faces/nahua/Expressionless.png">
      <img src="/images/faces/nahua/Happy.png">
      <img src="/images/faces/nahua/Joyful.png">
      <img src="/images/faces/nahua/Look.png">
      <img src="/images/faces/nahua/LookDown.png">
      <img src="/images/faces/nahua/Nervous.png">
      <img src="/images/faces/nahua/Neutral.png">
      <img src="/images/faces/nahua/Pensive.png">
      <img src="/images/faces/nahua/Sad.png">
      <img src="/images/faces/nahua/Scared.png">
      <img src="/images/faces/nahua/Shocked.png">
      <img src="/images/faces/nahua/Sigh.png">
      <img src="/images/faces/nahua/Sleepy.png">
      <img src="/images/faces/nahua/Smug.png">
      <img src="/images/faces/nahua/SmugEvil.png">
      <img src="/images/faces/nahua/Sus.png">
    </article>
    <article id="face-name">
      Hover over or click on a face!
    </article>
  </body>
  <script>
    const faceName = document.querySelector(`#face-name`);
    const faceSelector = document.querySelector(`#face-selector`);
    const allFaces = [...document.querySelectorAll(`#face-selector > img`)];
    
    let outlineTimeout = 0;
    
    const removeSelected = () => {
      [...document.querySelectorAll(`.selected`)].forEach(e=>e.classList.remove(`selected`));
      allFaces.forEach(e=>{
        if (e.style["outline-color"] === "var(--g2)") {
          e.style["outline-color"] = "";
        }
      });
      clearTimeout(outlineTimeout);
    };
    
    const writeClipboardText = async (text, element) => {
      try {
        await navigator.clipboard.writeText(text);
        removeSelected();
        element.style["outline-color"] = "var(--g2)";
        outlineTimeout = setTimeout(_=>{
          element.style["outline-color"] = "";
        }, 1000);
      } catch (error) {
        console.error(error.message);
      }
    };
    
    const getEmotion = (element) => {
      return element.src
        .match(/(\w+)\.png/)[1]
        .split(/(?<=[a-z])(?=[A-Z])/);
    };
    
    const faceUpdate = (element, event) => {
      removeSelected();
      element.classList.add(`selected`);
      const emotions = getEmotion(element);
      faceName.textContent = emotions.join(" ");
      faceName.setAttribute("who", "Nahua");
      faceName.setAttribute("emotion", emotions.join(""));
    };
    
    const faceCopy = (element, event) => {
      writeClipboardText(`<article who="nahua" emotion="${getEmotion(element).join("").toLowerCase()}">\n    \n  </article>`, element);
    };
    
    const doubleTapTimeWindow = 400;
    let lastTap = null;
    let tapTimeout = null;
    
    const touchyHandler = (element, event) => {
      console.log("touch input!");
      const now = Date.now();
      if (lastTap && (now - lastTap) < doubleTapTimeWindow) { // Double tap
        if (tapTimeout) clearTimeout(tapTimeout);
        faceCopy(element);
        lastTap = null;
      } else {
        faceUpdate(element);
        lastTap = now;
        tapTimeout = setTimeout(_=>{
          lastTap = null;
        }, doubleTapTimeWindow);
      }
    };
    
    allFaces.forEach(element => {
      element.addEventListener("mouseover", event => faceUpdate(element, event));
      element.addEventListener("mousedown", event => faceCopy(element, event));
      element.addEventListener("touchstart", event => {
        event.preventDefault();
        touchyHandler(element, event);
      });
    });
  </script>
</html>
